---
layout: post
title: API de Kongregate en Godot Engine
date: '2020-01-13T16:50:00.000-06:00'
author: Deybis A. Melendez Vargas
tags:
- tutorial
- Godot Engine
modified_time: '2020-01-24T13:38:01.289-06:00'
blogger_id: tag:blogger.com,1999:blog-5503112308634825503.post-8948654860099133674
blogger_orig_url: https://www.deybismelendez.com/2020/01/api-de-kongregate-en-godot-engine.html
---

He estado investigando cómo integrar la API de Kongregate con Godot,  ya que últimamente estoy interesado en participar en los concursos  mensuales de esta plataforma.<br />Estaba a punto de descargar Stencyl (un engine de videojuegos que ya  tiene kongregate integrado) cuando me dispuse a revisar si existía algún  script, plugin o lo que sea, que me permita trabajar con la API de  Kongregate en Godot, según las reglas de Kongregate, es necesario  incluir su API y darle uso para participar, así que encontré en la  documentación de Godot la clase JavaScript, con el que puedes ejecutar  la función eval.<br /><h2 id="integrando-la-api">Integrando la API</h2>Primero, necesario incluir en la etiqueta &lt;head&gt; del html el  kongregate-api.js, esto se puede hacer manualmente, luego de exportar el  juego a html5, modificamos el archivo html e incluimos la api, aunque  también lo podemos hacer directamente con Godot, en el momento de  exportar, incluimos en el parametro HEAD INCLUIDE lo siguiente:<br /><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="dl">'</span><span class="s1">text/javascript</span><span class="dl">'</span>  <span class="nx">src</span><span class="o">=</span><span class="dl">'</span><span class="s1">https://cdn1.kongregate.com/javascripts/kongregate_api.js</span><span class="dl">'</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;<br /></span></code></pre></div></div><img alt="Incluyendo el codigo en head include" src="https://i.imgur.com/EQ14yUQ.png" /><br />Luego de hacer esto, ya podemos trabajar con la API, pero hay que entender cómo hacerlo.<br /><h2 id="creando-el-plugin">Creando el plugin</h2>En nuestro proyecto de Godot, vamos a crear un script y le nombraremos <code class="language-plaintext highlighter-rouge">Kongregate.gd</code>, luego lo añadimos como un autoload.<br /><img alt="Creando el autoload Kongregate" src="https://i.imgur.com/esxhCze.png" /><br /><h2 id="cargando-la-api">Cargando la API</h2>Vamos a borrar todo el contenido del Kongregate.gd excepto la primer línea, que debería decir <code class="language-plaintext highlighter-rouge">Extends Node</code>.<br />Como ya tendremos el API de kongregate cargado en el Head del html,  ahora necesitamos cargar estas funciones, es decir inicializar la API.<br />Para lograr eso podemos poner lo siguiente:<br /><div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">_ready</span><span class="p">():</span><br />    <span class="kt">JavaScript</span><span class="o">.</span><span class="nf">eval</span><span class="p">(</span><span class="s">"kongregateAPI.loadAPI(function(){window.kongregate = kongregateAPI.getAPI();});"</span><span class="p">)</span><br /></code></pre></div></div>Cabe mencionar que si lo hacemos de esta manera, no podremos obtener  correctamente algunos parametros en el ready al instante, por lo que  debemos manejar esto con cuidado, opcionalmente podríamos incluir la  línea de javascript <code class="language-plaintext highlighter-rouge">kongregateAPI.loadAPI(function(){window.kongregate = kongregateAPI.getAPI();});</code> debajo de la etiqueta &lt;body&gt; de nuestro html, justo antes de  cualquier ejecución del juego, o bien, incluirlo en el Head Include al  momento de exportar, aunque esto último no es del todo recomendado.<br />Pero si no queremos complicarnos las cosas, podemos incluirlo en el <code class="language-plaintext highlighter-rouge">_ready</code>.<br /><h2 id="utilizando-la-api">Utilizando la API</h2>Como mencioné al inicio, podemos ejecutar la API de Kongregate con la  función eval() de la clase Javascript que trae Godot, podemos escribir  lo siguiente para obtener el nombre de usuario del jugador:<br /><div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">get_user_name</span><span class="p">():</span><br />    <span class="k">return</span> <span class="kt">JavaScript</span><span class="o">.</span><span class="nf">eval</span><span class="p">(</span><span class="s">"kongregate.services.getUsername();"</span><span class="p">)</span><br /></code></pre></div></div>Con esto estamos ejecutando la API de Kongregate y al mismo tiempo  obtener el resultado. De esta manera podemos acceder al nombre del  usuario en cualquier parte de nuestro juego escribiendo <code class="language-plaintext highlighter-rouge">Kongregate.get_user_name()</code><br />Podemos subir las estadisticas del juego con la siguiente función:<br /><div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">submit_stats</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span><br /> <span class="kt">   JavaScript</span><span class="o">.</span><span class="nf">eval</span><span class="p">(</span><span class="s">"kongregate.stats.submit('"</span><span class="o">+</span> <span class="n">stat</span> <span class="o">+</span><span class="s">"', "</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">");"</span><span class="p">)</span><br /></code></pre></div></div>Nótese que al rededor de la palabra stat en la segunda línea, hay  comillas simples y dobles, esto es porque la función eval requiere que  la sentencia se escriba como String, y la función submit require que el  stat sea un string, la función debería escribirse: <code class="language-plaintext highlighter-rouge">kongregate.stats.submit('stat', value);</code> donde stat es un string y value un número entero.<br />Con esto, ya podemos trabajar en añadir las funciones que queramos de  la API de Kongregate, ya mostré cómo incluir las 2 mas básicas, me  quedaría pendiente crear un script que incluya al menos las funciones  mas importantes, como guardar partida, cargar partida, entre otras…<br />El código que hemos escrito en su totalidad sería el siguiente:<br /><div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">extends</span> <span class="kt">Node</span><br /><br /><span class="kd">func</span> <span class="nf">_ready</span><span class="p">():</span><br /> <span class="kt">   JavaScript</span><span class="o">.</span><span class="nf">eval</span><span class="p">(</span><span class="s">"kongregateAPI.loadAPI(function(){window.kongregate = kongregateAPI.getAPI();});"</span><span class="p">)</span><br /><br /><span class="kd">func</span> <span class="nf">get_user_name</span><span class="p">():</span><br /> <span class="k">   return</span> <span class="kt">JavaScript</span><span class="o">.</span><span class="nf">eval</span><span class="p">(</span><span class="s">"kongregate.services.getUsername();"</span><span class="p">)</span><br /><br /><span class="kd">func</span> <span class="nf">submit_stats</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span><br />    <span class="kt">JavaScript</span><span class="o">.</span><span class="nf">eval</span><span class="p">(</span><span class="s">"kongregate.stats.submit('"</span><span class="o">+</span> <span class="n">stat</span> <span class="o">+</span><span class="s">"', "</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">");"</span><span class="p">)</span><br /></code></pre></div></div>Esto es mas que suficiente para cumplir con la regla de incluir la  API de kongregate y ya podremos participar en los concursos mensuales.  Mas adelante publicaré un repositorio con la API mas importante y que  podemos usar para sacarle mas provecho a esta plataforma.<br /><br />A continuación el código que uso actualmente:<br /><br /><script src="https://gist.github.com/DeybisMelendez/7ff236bf97cb6de4ebf680cb34c3a4dc.js"></script>